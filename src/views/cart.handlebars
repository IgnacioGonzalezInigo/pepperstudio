<div class="container py-5" data-cid="{{cid}}">

  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-4">
    <div>
      <h1 class="h4 mb-1">Tu carrito</h1>
      <div class="text-muted small">
        Cart ID: <span class="font-monospace">{{cid}}</span>
      </div>
    </div>

    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="/products">Seguir comprando</a>
      <button class="btn btn-outline-danger js-clear-cart" {{#unless items.length}}disabled{{/unless}}>
        Vaciar carrito
      </button>
    </div>
  </div>

  {{#if items.length}}
    <div class="row g-4">
      <!-- LISTADO -->
      <div class="col-12 col-lg-8">
        <div class="card border-0 shadow-sm">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th style="min-width:280px;">Producto</th>
                    <th class="text-end" style="width:140px;">Precio</th>
                    <th class="text-center" style="width:220px;">Cantidad</th>
                    <th class="text-end" style="width:160px;">Subtotal</th>
                    <th class="text-end" style="width:120px;"></th>
                  </tr>
                </thead>

                <tbody id="cartTbody">
                  {{#each items}}
                    <tr class="js-item" data-pid="{{this.product._id}}">
                      <td>
                        <div class="d-flex gap-3">
                          <img
                            src="{{#if this.product.thumbnails.[0]}}/img/{{this.product.thumbnails.[0]}}{{else}}/img/products/placeholder.jpg{{/if}}"
                            alt="{{this.product.title}}"
                            style="width:72px;height:72px;object-fit:cover;border-radius:12px;"
                          />
                          <div>
                            <div class="fw-semibold">{{this.product.title}}</div>
                            <div class="text-muted small">
                              {{this.product.category}} Â· stock {{this.product.stock}}
                            </div>
                            <a class="small text-decoration-none" href="/products/{{this.product._id}}">Ver detalle â†’</a>
                          </div>
                        </div>
                      </td>

                      <td class="text-end">
                        <span class="js-price" data-price="{{this.product.price}}">
                          ${{this.product.price}}
                        </span>
                        <span class="text-muted small">ARS</span>
                      </td>

                      <td class="text-center">
                        <div class="d-inline-flex align-items-center gap-2">
                          <button class="btn btn-outline-secondary btn-sm js-dec" type="button" title="Restar">
                            âˆ’
                          </button>

                          <input
                            class="form-control form-control-sm text-center js-qty"
                            style="width:90px;"
                            type="number"
                            min="1"
                            value="{{this.quantity}}"
                          />

                          <button class="btn btn-outline-secondary btn-sm js-inc" type="button" title="Sumar">
                            +
                          </button>
                        </div>

                        <div class="small text-muted mt-1 js-qty-status"></div>
                      </td>

                      <td class="text-end">
                        <span class="fw-semibold js-line-total">
                          ${{this.lineTotal}}
                        </span>
                        <span class="text-muted small">ARS</span>
                      </td>

                      <td class="text-end">
                        <button class="btn btn-outline-danger btn-sm js-remove" type="button">
                          Eliminar
                        </button>
                      </td>
                    </tr>
                  {{/each}}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="alert alert-light border mt-3 mb-0">
          Tip: podÃ©s usar los botones +/âˆ’ o escribir la cantidad y salir del input.
        </div>
      </div>

      <!-- RESUMEN -->
      <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h2 class="h6 mb-3">Resumen</h2>

            <div class="d-flex justify-content-between mb-2">
              <span class="text-muted">Items</span>
              <span class="fw-semibold" id="cartItemsCount">{{items.length}}</span>
            </div>

            <hr />

            <div class="d-flex justify-content-between align-items-center">
              <span class="text-muted">Total</span>
              <div class="h5 mb-0">
                <span id="cartTotal">${{total}}</span>
                <span class="text-muted small">ARS</span>
              </div>
            </div>

            <button class="btn btn-dark w-100 mt-3" type="button" disabled>
              Finalizar compra (demo)
            </button>

            <div class="small text-muted mt-2">
              (Para la entrega, con que puedas modificar/eliminar/vaciar alcanza.)
            </div>
          </div>
        </div>
      </div>
    </div>
  {{else}}
    <div class="card border-0 shadow-sm">
      <div class="card-body py-5 text-center">
        <div class="display-6 mb-2">ðŸ›’</div>
        <h2 class="h5">Tu carrito estÃ¡ vacÃ­o</h2>
        <p class="text-muted mb-3">AgregÃ¡ productos desde la secciÃ³n de productos.</p>
        <a class="btn btn-dark" href="/products">Ir a productos</a>
      </div>
    </div>
  {{/if}}
</div>

<script type="module" src="/js/cart/cartView.js"></script>